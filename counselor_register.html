<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="css/style.css">
	<title>Team Roots</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script src="http://www.parsecdn.com/js/parse-1.5.0.min.js"></script>
	<script src="js/layer.js"></script>
	<script>
		Parse.initialize("pya3k6c4LXzZMy6PwMH80kJx4HD2xF6duLSSdYUl", "nsAogGRd3LmObBE5jk1E3pilVTDbPGAEHpTZwvob");
		if (typeof(Storage) != "undefined") {
			if (!localStorage.getItem("hasCode")) window.location = "counselor_activation.html";
		}
	</script>
</head>
<body>
	<div id="container">
		<img id="title" src="img/team-roots-logo.png">

		<form id="register-form">
			<input type="email" name="email" class="form-field" placeholder="Email" required><br>
			<input type="text" name="name" class="form-field" placeholder="Name" required><br>
			<input type="password" name="password" class="form-field" placeholder="Password" required><br>
			<p id="note"></p>
			<input type="submit" class="button" value="Next">
		</form>
	</div>

	<script>
		document.getElementById("register-form").addEventListener("submit", function (e) {
			e.preventDefault();

			// password check
			var password_input = this.elements["password"].value;
			if (password_input.length < 6) {
				document.getElementById("note").innerHTML = "password must be at least 6 characters";
			} else if (!(/[0-9]/.test(password_input))) {
				document.getElementById("note").innerHTML = "password must contain a number";
			} else if (!(/[a-z]/.test(password_input))) {
				document.getElementById("note").innerHTML = "password must contain a lowercase alphabetical character";
			} else if (!(/[A-Z]/.test(password_input))) {
				document.getElementById("note").innerHTML = "password must contain an uppercase alphabetical character";
			} else {
				// store user
				var user = new Parse.User();
				user.set("username", this.elements["email"].value);
				user.set("password", this.elements["password"].value);
				user.set("name", this.elements["name"].value);
				user.set("email", this.elements["email"].value);
				user.set("counselorType", "1");
				user.set("isAvailable", true);

				//remove note
				document.getElementById("note").innerHTML = null;

				//send to welcome page
				user.signUp(null)
				.then(function (user) {
					return layer.getNonce();
				}, function (error) {
					alert("Error: " + error.code + " " + error.message);
				})
				.then(function (nonce) {
					return layer.authenticate(nonce, user.id)
				})
				.then(function (sessionToken) {
					window.location = "counselor_welcome.html";
				});
			}
		});
	</script>

	<div id="footer">
		<a href="mailto:spencer@teamroots.org" class="get-notified">Contact us</a>
	</div>
</body>
</html>
